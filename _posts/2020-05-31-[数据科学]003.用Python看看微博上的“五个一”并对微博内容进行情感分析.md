---
layout:     post
title:      [æ•°æ®ç§‘å­¦]003.ç”¨Pythonçœ‹çœ‹å¾®åšä¸Šçš„â€œäº”ä¸ªä¸€â€å¹¶å¯¹å¾®åšå†…å®¹è¿›è¡Œæƒ…æ„Ÿåˆ†æ
subtitle:   äº”ä¸ªä¸€
date:       2020-05-31
author:     Mr.X | Xå¸ˆå‚…
header-img: img/post-bg-wugeyi.jpg
catalog: true
tags:
    - æ•°æ®ç§‘å­¦
    - python
    - æƒ…æ„Ÿåˆ†æ
---


# å‰è¨€ï¼š
èº«ä¸ºæµ·å¤–å…šï¼Œå¹³æ—¶æ²¡äº‹å„¿å°±çœ‹çœ‹æœºç¥¨çš„Xå¸ˆå‚…çªç„¶è¢«å›å›½çš„ç¥¨ä»·å“ä½äº†ï¼ 
- å·´é»é£åŒ—äº¬ ï¼š å›½èˆªç»æµèˆ± è¦ 3W+ ï¼ˆå•ç¨‹ï¼‰
- å·´é»é£ä¸Šæµ· ï¼š ä¸œèˆªç»æµèˆ± ä¹Ÿå¾—3W+  ï¼ˆå•ç¨‹ï¼‰

éšç€äº”ä¸ªä¸€å»¶ç»­åˆ°10æœˆåº•ï¼ŒXå¸ˆå‚…ä¸Šä¸ªæœˆä¹°çš„å¤–èˆªèˆªç­è¢«å–æ¶ˆï¼Œæœºç¥¨ä»·æ ¼ä¹Ÿæ¶¨ä»·6å€ã€‚éš”ç¦»æœŸçœä¸‹çš„ç¥¨å­ï¼Œè¿™æŠŠä¸€ä¸‹å…¨æ¢­å“ˆäº†ï¼å·¥ä½œå¤§åŠå¹´ï¼Œèµ„äº§æ²¡å˜ï¼Œè´Ÿå€ºå€’æ˜¯å¢åŠ äº†ä¸å°‘ã€‚

å¹³å¤äº†ä¸€ä¸‹ è¢«géŸ­èœçš„å¿ƒæƒ…ï¼ˆéš”ç¦»æœŸçˆ†è‚¥+æ‰¾å¤–èˆªé€€é’±æ— æœ+è¡€äºä¸€ç¬”ï¼‰ï¼Œæœ¬ç€äºä¸æ­¢æˆ‘ä¸€äººåƒçš„åŸåˆ™ï¼Œ Xå¸ˆå‚…è·‘å»å¾®åšçœ‹äº†çœ‹è¿™ä¸ªè¯é¢˜ï¼š
- æ°‘èˆªå±€ç½‘ç«™è¢«çˆ†
- ç½‘å‹å˜²ç•™å­¦ç”Ÿåƒé‡ŒæŠ•æ¯’
- è¿˜æœ‰äºº @æˆ˜ç‹¼ å¸¦æˆ‘å›å®¶

æœç„¶ï¼Œåƒäºçš„ä¸åªæ˜¯æˆ‘ä¸€ä¸ªäººï¼ˆæ‰‹åŠ¨ç‹—å¤´ğŸ•ï¼‰
èµ¶ç´§ä¸‹è½½ï¼ˆpaï¼‰ç‚¹æ•°æ®ä¸€æ¢ç©¶ç«Ÿï¼
 
æœ¬ç‰‡ä¸­çš„æ‰€æœ‰ä»£ç éƒ½åœ¨è¿™ä¸ªrepoä¸­ï¼š 
>(Xå¸ˆå‚…çš„github)[https://github.com/pickpikyup/blogs_-] 

## åŸºæœ¬æƒ…å†µ
- å¾®åšæ•°æ®
- python æ•°æ®å¤„ç†
- ç™¾åº¦AI è‡ªç„¶è¯­è¨€å¤„ç†
- Plotlyæ•°æ®å¯è§†åŒ–
# 1. æ•°æ®æ¥æº ï¼š 
- #### æ–°æµªå¾®åš
- #### çŸ¥ä¹ ï¼ˆto doï¼‰
- #### å¤´æ¡ï¼ˆto doï¼‰
Xå¸ˆå‚…å†™äº†ä¸ªç®€å•çš„çˆ¬è™«, ç»“æœå¹²ä¸è¿‡æ–°æµªçš„åæ‰’æœºåˆ¶ï¼Œæ²¡è¿‡å¤šä¹…å°±è¢«å°IPäº†ï¼ äºæ˜¯å†³å®šä¸Šç½‘æœæœä¼˜ç§€è½®å­ï¼
ç»“æœè®©æˆ‘æ‰¾åˆ°äº†ä¸€ä¸ª ä¸é”™çš„é’ˆå¯¹è¯é¢˜çš„çˆ¬è™«ã€‚å…¶ä¸­æœ‰GUIç‰ˆæœ¬å’Œæ™®é€šç‰ˆï¼Œ ä»£ç ç®€å•ï¼Œç»“æ„æ¸…æ¥šï¼Œæ™®é€šç‰ˆéå¸¸å®¹æ˜“æ›´æ”¹ï¼Œå¹¶å°†ä¹‹éƒ¨ç½²åœ¨æœ¬åœ°ã€‚ä¿—è¯è¯´çš„å¥½ï¼Œä¸“ä¸šçš„äº‹è¦äº¤ç»™ä¸“ä¸šçš„äººå»åšï¼Œçœ‹äº†äººå®¶çš„çˆ¬è™«ï¼Œè±ç„¶å¼€æœ—ï¼Œçˆ¬æ•°æ®ï¼Œæœç„¶è¿˜æ˜¯çˆ¬å–**ç§»åŠ¨ç«¯**æ›´æœ‰æ•ˆï¼ï¼ ä¸‹é¢é™„ä¸ŠåŸgithubé“¾æ¥ã€‚
	
> Link: [github è¶…çº§å¾®åšçˆ¬è™«](https://github.com/Python3Spiders/WeiboSuperSpider)

äº”ä¸ªä¸€åœ¨3æœˆ16æ—¥å‘å¸ƒï¼Œæ­£å¼å®è¡Œæ—¥æœŸä¸º3æœˆ29å·åˆ°6æœˆ31æ—¥ã€‚ç„¶å5æœˆ19æ—¥å®£å¸ƒå°†å»¶é•¿åˆ°10æœˆåº•ã€‚ç„¶å5æœˆ20æ—¥å·¦å³ï¼Œç¤¾åª’å°±ç‚¸é”…äº†ã€‚ã€‚

å‡ ä¸ªæ—¶é—´ç‚¹ï¼š
- å‘å¸ƒæ—¥æœŸï¼š 3æœˆ16æ—¥
- ç¬¬ä¸€é˜¶æ®µå®è¡Œæ—¥æœŸ ï¼š 3æœˆ29æ—¥åˆ°6æœˆ31æ—¥
- å®£å¸ƒå»¶é•¿æ—¥æœŸï¼š5æœˆ19æ—¥
- ç¬¬äºŒé˜¶æ®µå»¶é•¿æ—¥æœŸ ï¼š 7æœˆ1æ—¥åˆ°10æœˆ31æ—¥ï¼ˆå¤§æ¦‚æ˜¯è¿™ä¸ªæ—¥æœŸï¼‰

æ‰€ä»¥ æˆ‘ä»¬çš„æ•°æ®æ—¶é—´èŒƒå›´ä¸º3æœˆ16æ—¥åˆ° 5æœˆ30æ—¥ã€‚ä¸€åˆ‡å°±ç»ªï¼Œâ€œä¸‹è½½â€ æ•°æ®ï¼

**Tips**ï¼šè¿™é‡Œè¯´å‡ ä¸ªéƒ¨ç½²çˆ¬è™«çš„å°æŠ€å·§ï¼Œ
- ä¸ºäº†ä¿è¯çˆ¬è™«çš„ç¨³å®šæ€§ï¼Œæ¯ç¿»3-5é¡µçš„æ—¶å€™æœ€å¥½sleep 10åˆ°15 ç§’ã€‚å¦‚æœçˆ¬è™«å¾ˆæ¸©å’Œï¼Œå°±ä¸ä¼šç»™ç›®æ ‡æœåŠ¡å™¨å¤ªå¤šå‹åŠ›ï¼Œä¹Ÿé˜²æ­¢è¢«åæ‰’æœºåˆ¶å¹²æ‰ã€‚åˆ©äººåˆ©å·±ã€‚ 
- å¯¹äºå¾®åšè¿™ç§ç¤¾äº¤å¤§å¹³å°ï¼Œæ–°æ³¨å†Œè´¦å·çš„å°ç¦ç‡ç‰¹åˆ«é«˜ï¼Œæ€•éº»çƒ¦çš„åŒå­¦å¯ä»¥ç”¨è‡ªå·±çš„å¾®åšè´¦å· ï¼ˆä¹Ÿå¯ä»¥ç”¨å¥³æœ‹å‹çš„å· xDï¼‰
- åå¤çˆ¬å–ç›¸åŒçš„æ—¥æœŸï¼Œè¯´ä¸å®šå°±èƒ½æ‰¾åˆ°ä»¥å‰é—æ¼çš„æ•°æ® ã€‚  â€æ¸©æ•…è€ŒçŸ¥æ–°â€œ
- æœ€æœ€é‡è¦çš„ä¸€ç‚¹ï¼š ä¸‹è½½åˆ°çš„æ•°æ® åƒä¸‡-åƒä¸‡-åƒä¸‡ **ä¸è¦æéæ³•ç”¨é€”**ï¼Œä¸ç„¶çˆ¬è™«å°±æ˜¯ç¨‹åºå‘˜é€šå‘ç›‘ç‹±çš„æœ€å¿«è·¯å¾„ï¼ï¼ï¼
# 2. EDAï¼š
## 2.1 æ•°æ®é¢„å¤„ç†
ç»è¿‡ä¸€æ®µæ—¶é—´çš„çˆ¬å–ï¼Œæ•°æ®é‡çœ‹èµ·æ¥ä¸é”™ï¼Œä½†æ˜¯æœ‰å¤§é‡é‡å¤çš„å¾®åšï¼Œå¹¶ä¸”æ•°æ®æ ¼å¼æœ‰è¯¯ã€‚å…ˆå¯¹åŸå§‹æ•°æ®è¿›è¡Œé¢„å¤„ç†
- æ ¹æ®å¾®åšæ­£æ–‡ï¼Œå¾®åšidï¼Œå‘å¸ƒæ—¶é—´ï¼Œå»é™¤çˆ¬å–åˆ°é‡å¤çš„å¾®åšã€‚
- è®¡ç®— å¾®åšäº’åŠ¨æ•° = ç‚¹èµæ•°+è½¬å‘æ•°+è¯„è®ºæ•°+1
- è€ƒè™‘åˆ°å¾®åšä¸Šæœ‰å¤§é‡å®˜æ–¹åª’ä½“ï¼Œè‡ªåª’ä½“å’Œç§äººç”¨æˆ·ã€‚é‡‡ç”¨ç²‰ä¸æ•°é‡ï¼Œç²‰ä¸æ´»è·ƒç¨‹åº¦ å’Œäº¤äº’æ•°é‡æ¥åŒºåˆ†è¿™äº›åª’ä½“ã€‚ï¼ˆè¿™éƒ¨åˆ†å†…å®¹ä¸å¤Ÿå®Œå–„ï¼Œæœ‰æ›´å¥½çš„å»ºè®®è¯·ç»™Xå¸ˆå‚…ç•™è¨€ï¼ï¼‰
- å¤„ç†å¾®åšæ­£æ–‡å†…å®¹ï¼Œæ¶ˆé™¤textä¸­çš„ç‰¹æ®Šç¬¦å·ï¼Œæå–å…³é”®tagã€‚ 

```python
    import os
    import pandas as pd
    import numpy as np

    # Prepare Data
    def remove_duplicates(df):
        size_before = df.shape[0]
        df = df.drop_duplicates(subset=['å¾®åšæ­£æ–‡','å¾®åšid','å‘å¸ƒæ—¶é—´'])
        size_after = df.shape[0]

        print(u'é‡å¤å¾®åš æ•°é‡ï¼š%d'%(size_before-size_after))
        return df
        
    def add_interativity(df):
        df['nb_interactivity'] = df[['ç‚¹èµæ•°', 'è½¬å‘æ•°' ,'è¯„è®ºæ•°']].sum(axis=1) + 1
        df['å‘å¸ƒæ—¶é—´'] = pd.to_datetime(df['å‘å¸ƒæ—¶é—´'])
        df['date'] = df['å‘å¸ƒæ—¶é—´'].dt.date
        df['date'] = pd.to_datetime(df['date'])

        print(df['date'].min(), df['date'].max())
        return df  

    # ä»éœ€æ”¹è¿›
    def add_identity(df):
        # å¦‚ä½•ç•Œå®šå¤§V , 50w ç²‰ä¸ 
        df['if_å¤§V'] = 0
        df.loc[df['å‘å¸ƒè€…ç²‰ä¸æ•°']>=500000, 'if_å¤§V'] = 1

        # å¤šç²‰ å°‘äº’åŠ¨
        df['if_å®˜åª’'] = 0
        df.loc[(df['nb_interactivity']/(df['å‘å¸ƒè€…ç²‰ä¸æ•°']+1)) < 0.00002, 'if_å®˜åª’'] = 1

        # å¤šç²‰ é«˜äº’åŠ¨
        df['if_è‡ªåª’'] = 0
        df.loc[((df['nb_interactivity']/(df['å‘å¸ƒè€…ç²‰ä¸æ•°']+1))>0.0005)&(df['å‘å¸ƒè€…ç²‰ä¸æ•°']>50000), 'if_è‡ªåª’'] = 1

        # èº«ä»½ä¿®æ­£
        ## å®˜åª’ list
        l1 = ['ä¸­å›½æ°‘èˆªç½‘','']
        df.loc[df['å‘å¸ƒè€…å§“å'].isin(l1), 'if_å®˜åª’'] = 1
        df.loc[df['å‘å¸ƒè€…å§“å'].isin(l1), 'if_è‡ªåª’'] = 0
        df.loc[df['å‘å¸ƒè€…å§“å'].isin(l1), 'if_ä¸ªäººç”¨æˆ·'] = 0

        ## è‡ªåª’ list
        l2 = ['å°qqqé˜¿','èƒ¡èˆ’ç«‹','FATIII']
        df.loc[df['å‘å¸ƒè€…å§“å'].isin(l2), 'if_å®˜åª’'] = 0
        df.loc[df['å‘å¸ƒè€…å§“å'].isin(l2), 'if_è‡ªåª’'] = 1
        df.loc[df['å‘å¸ƒè€…å§“å'].isin(l2), 'if_ä¸ªäººç”¨æˆ·'] = 0

        # å…¶ä»– 
        df['if_ä¸ªäººç”¨æˆ·'] = 0
        df.loc[(df['if_å¤§V'] == 0) & (df['if_å®˜åª’'] == 0) & (df['if_è‡ªåª’'] == 0),'if_ä¸ªäººç”¨æˆ·'] = 1

        return df

    df = remove_duplicates(pd.read_csv('../data/data.csv'))
    df = add_interativity(df)
    df = add_identity(df)
```

åŸºæœ¬å¤„ç†å®Œäº†ä¹‹åï¼Œåˆæ­¥çˆ¬åˆ°3000å¤šæ¡ç›¸å…³çš„åŸåˆ›å¾®åšã€‚
åŸºæœ¬æƒ…å†µå¦‚ä¸‹ï¼š
| åŸåˆ›å¾®åšæ•° | è½¬å‘æ•° | è¯„è®ºæ•°| ç‚¹èµæ•°| æ€»äº’åŠ¨æ•°|
|----------------|----------|------------|-----------|----------|
| 3620 | 35927 | 90420| 497735| 627712|

è¿™æ˜¯3æœˆ16æ—¥è‡³5æœˆ30æ—¥ä¹‹é—´çš„æ•°æ®ï¼Œåœ¨è¿™å°†è¿‘74å¤©çš„æ—¥å­é‡Œï¼Œæ€»äº’åŠ¨æ•°å°†è¿‘63ä¸‡ã€‚ å¹³å‡æ¯å¤©äº’åŠ¨æ•°é‡ä¸åˆ°1ä¸‡ã€‚ä¹ä¸€çœ‹çƒ­åº¦ä¸æ€ä¹ˆé«˜ï¼ 


é‚£æˆ‘ä»¬åœ¨æŸ¥çœ‹ä¸€ä¸‹æ¯æ—¥å¾®åšæ•°é‡ï¼Œåœ¨å®˜å®£å»¶é•¿ä¹‹åï¼Œ5æœˆ19æ—¥è¯é¢˜åº¦çªç„¶æå‡ã€‚ã€‚ã€‚

```python
from plotly import express as px

data = df.groupby('date').agg({'å¾®åšæ­£æ–‡' : 'count', 'è½¬å‘æ•°':'sum'})[['å¾®åšæ­£æ–‡','è½¬å‘æ•°']].reset_index()
data['å¹³å‡è½¬å‘æ•°'] = data['è½¬å‘æ•°']/data['å¾®åšæ­£æ–‡']
fig = px.bar(data_frame=data, y='å¾®åšæ­£æ–‡',x='date',text='å¾®åšæ­£æ–‡')
fig.update_layout(width=1000, title = 'äº”ä¸ªä¸€-æ¯æ—¥åŸåˆ›å¾®åšæ•°')
fig.show()
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://user-gold-cdn.xitu.io/2020/6/2/17273f6e104e205c?w=1689&h=752&f=png&s=81185)
ä½†æ˜¯è¿™æ®µæ—¶é—´é‡Œï¼Œ5æœˆ20æ—¥ï¼Œ22æ—¥ï¼Œè¿™å‡ å¤©çš„å¾®åšæ•°é‡å¼‚å¸¸çš„å°‘ï¼Œæœ‰ç‚¹ä¸å¯¹åŠ²å„¿ã€‚è¿™é‡Œæˆ‘æå‡ºä¸€ä¸ªå‡è®¾ï¼š
- åœ¨è¿™å‡ å¤©é‡Œï¼Œæµ·å¤–èˆªç©ºå…¬å¸é¢„å”®çš„å›å›½æœºç¥¨é™†ç»­è¢«å–æ¶ˆï¼Œæ‰€ä»¥å¤§é‡ç”¨æˆ·å‘è¡¨ç›¸å¯¹è¿‡æ¿€çš„è¨€è®ºï¼Œå¯¼è‡´è¢«åˆ è´´ï¼Œä¸‹æœç´¢ã€‚
- ä¹Ÿå¯èƒ½æ˜¯ï¼Œæ–°æµªåå¢ƒå¤–çˆ¬è™«é™åˆ¶ï¼Œå¯¼è‡´æ•°æ®ä¸‹è½½ä¸é½å…¨ã€‚

æˆ‘ä»¬å†çœ‹çœ‹æµ·å†…å¤–å¯¹è¿™ä¸ªè¯é¢˜çš„çš„å…³æ³¨åº¦

```python
import cufflinks as cf 
cf.go_offline()
cf.set_config_file(offline=False, world_readable=True)

fig = df.å‘å¸ƒè€…åœ°åŒº.value_counts().iloc[:15].iplot(kind='barh', asFigure=True)
fig.update_layout(height=400, title='å¾®åšå‘å¸ƒè€…æ‰€åœ¨åœ°åŒº Count')
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://user-gold-cdn.xitu.io/2020/6/2/17273f6e114b64ba?w=1123&h=600&f=png&s=52921)

å…¶å®æƒ³ä¸€æƒ³ä¹ŸçŸ¥é“ï¼Œæµ·å¤–åäººï¼Œä½œä¸ºå—å½±å“æœ€ä¸¥é‡çš„ç¾¤ä½“ï¼Œè‡ªç„¶è€Œç„¶æ›´åŠ å…³æ³¨è¿™ä¸ªè¯é¢˜ã€‚å¯¹äºå›½å†…è¿™äº›åŸå¸‚ï¼ŒåŒ—ä¸Šå¹¿ä¹Ÿéƒ½æ˜¯äººå£å¯†é›†çœä»½ï¼Œè‡ªç„¶è€Œç„¶ï¼Œå‘çš„å¾®åšä¹Ÿå°±å¤šä¸€äº›ã€‚

**ä½†æ˜¯**ï¼Œæˆ‘è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç–‘é—®ï¼ŒåŒ—äº¬çš„è¯é¢˜å…³æ³¨åº¦è¦æ¯”å…¶ä»–åœ°åŒºéƒ½å¤šä¸€äº›ã€‚
- å¯èƒ½æ˜¯å„å¤§åª’ä½“çš„å®˜æ–¹å‘å¸ƒåœ°å€æ˜¯åœ¨åŒ—äº¬å§ã€‚ã€‚ã€‚

|  | æµ·å¤– | åŒ—äº¬ | ä¸Šæµ· |
|--|--|--|--|
| å¤§Væ¯”ä¾‹ | 2% | 19% | 10% |
| å®˜åª’æ¯”ä¾‹ | 1% | 16% | 6%|
| è‡ªåª’æ¯”ä¾‹ | 2% | 4%| 3%|
| æ™®é€šç”¨æˆ·æ¯”ä¾‹ | 94% | 61%| 81%|

ç»Ÿè®¡ä¸€ä¸‹ï¼Œæœç„¶ï¼ŒåŒ—äº¬è¿˜æ˜¯è¿™äº›åª’ä½“æ¯”ä¾‹æœ€é«˜çš„åœ°åŒºï¼Œä¹Ÿéš¾æ€ªå¯¹è¿™äº›ä¸ªè¯é¢˜å…³æ³¨åº¦è¦é«˜ä¸€äº›ã€‚

å†å±•å¼€çœ‹çœ‹åŒ—äº¬è¿™äº›ä¸ªå¾®åšéƒ½æ˜¯ä»€ä¹ˆæ—¶å€™å‘çš„ï¼š 

```python
# å…³æ³¨åº¦
df_temp = df[df['å‘å¸ƒè€…åœ°åŒº'] == 'åŒ—äº¬']
delays = (df_temp['date'] - df_temp['date'].min()).dt.days.values

# color_pallet = sns.color_palette('RdBu_r',delays.max()+1)

fig=go.Figure(layout=dict(width=800, height=700, title='åŒ—äº¬åœ°åŒºå¯¹â€˜äº”ä¸ªä¸€â€™ è¯é¢˜å…³æ³¨åº¦ - é¢œè‰²è¶Šæµ…,å‘å¸ƒæ—¶é—´è¶Šä¹…'))

trace = go.Scatter(
    x=df_temp['å‘å¸ƒè€…ç²‰ä¸æ•°'],
    y=df_temp['nb_interactivity'],
    opacity=0.7,
    mode='markers',
    marker=dict(
        # size=(delays**2)/500,
        color=delays[::-1]
    ),
    text=df_temp['date'].dt.date
)

fig.add_trace(trace)
fig.update_layout(
    yaxis={'type':'log', 'title':'äº’åŠ¨æ¬¡æ•°'}, 
    xaxis={'type':'log', 'title':'å‘å¸ƒè€…ç²‰ä¸æ•°'})
fig.show()
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://user-gold-cdn.xitu.io/2020/6/2/17273f6e36d20cef?w=1298&h=1135&f=png&s=141088)
ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œ ç²‰ä¸å¤šäº’åŠ¨å¤šçš„å¾®åšéƒ½æ˜¯å¾ˆä¹…ä¹‹å‰å‘çš„ï¼Œ5æœˆä»½çš„å¾®åšï¼ˆç´«è‰²ï¼‰ä¹Ÿä¸»è¦æ˜¯ä¸ªäººç”¨æˆ·å‘çš„ã€‚ï¼ˆæœç„¶ï¼Œä¸€è¢«å–·ï¼Œå®˜æ–¹å¾®åšå°±å“‘å·´äº†ã€‚ã€‚ã€‚lolï¼‰

ç²—ç•¥çœ‹äº†ä¸€ä¸‹æ•°æ®ï¼Œä¸‹é¢ä¸ºäº†æ–¹ä¾¿æ–‡å­—æƒ…æ„Ÿåˆ†æï¼Œæˆ‘ä»¬è¿˜å¾—ç¨å¾®æ¸…ç†ä¸€ä¸‹å¾®åšæ­£æ–‡çš„å¥‡æ€ªç¬¦å·ã€‚

```python
from string import punctuation
import re

# Used in preprocessing_hanzi
def clean(text):
    """
    copy from : https://blog.csdn.net/blmoistawinde/article/details/103648044
    """
    text = re.sub(r"(å›å¤)?(//)?\s*@\S*?\s*(:| |$)", " ", text)  # å»é™¤æ­£æ–‡ä¸­çš„@å’Œå›å¤/è½¬å‘ä¸­çš„ç”¨æˆ·å
    text = re.sub(r"\[\S+\]", "", text)      # å»é™¤è¡¨æƒ…ç¬¦å·
    # text = re.sub(r"#\S+#", "", text)      # ä¿ç•™è¯é¢˜å†…å®¹
    URL_REGEX = re.compile(
        r'(?i)\b((?:https?://|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:\'".,<>?Â«Â»â€œâ€â€˜â€™]))',
        re.IGNORECASE)
    text = re.sub(URL_REGEX, "", text)       # å»é™¤ç½‘å€
    text = text.replace("è½¬å‘å¾®åš", "")       # å»é™¤æ— æ„ä¹‰çš„è¯è¯­
    text = re.sub(r"\s+", " ", text) # åˆå¹¶æ­£æ–‡ä¸­è¿‡å¤šçš„ç©ºæ ¼
    return text.strip()
    
# Clean Weibo Texts
def preprocessing_hanzi(text):
    """
    å¾®åšæ­£æ–‡é¢„å¤„ç†
    """
   
    text = clean(text)

    # å»é™¤å‘å¸–äºº
    text = ":".join(text.split(':')[1:])
    # å»é™¤ \xa0ä¹‹åçš„å†…å®¹
    text = text.split('\xa0')[0]
    
    # å»é™¤ ä¸­è‹±ç¬¦å· non stop ç¬¦å·
    punctuation_hanzi = punctuation+"ï¼ˆï¼‰ã€ã€‘â€˜â€™â€â€œã€Šã€‹ï¿¥&â€¦â€¦â€”"
    text = re.sub(r'[{}]+'.format(punctuation_hanzi), "", text)

    # å»é™¤å¥‡æ€ªç‰¹æ®Šç¬¦å·
    text = re.sub(r'\u3000', "", text)
    
    # TODO å»é™¤è¿ç»­é‡å¤æ— æ„ä¹‰ç¬¦å· / æ–‡å­—ï¼Œ 
    return text.strip()

df['preprocessed_text'] = df['å¾®åšæ­£æ–‡'].apply(preprocessing_hanzi)
```

>**å¤„ç†å‰**ï¼š['æ˜“å°¬ä¸€çˆ†ç‚¸HAN:ä»å°åˆ°å¤§ å°±è¢«è¯´ æ²¡å¿ƒæ²¡è‚º å¾ˆå¤šäº‹æƒ…ä¸å®¹æ˜“å½“å›äº‹ä½†çœŸçš„è¿™ä¸ªäº”ä¸ªä¸€ é™èˆª** æƒ³å¿… æˆ‘èƒ½è®°å¾ˆä¹… ç”šè‡³ä¸€è¾ˆå­å§ è‹±å›½Â·æ ¼æ‹‰æ–¯å“¥ \xa0æ˜¾ç¤ºåœ°å›¾\xa0',
>**å¤„ç†å**ï¼š 'ä»å°åˆ°å¤§ å°±è¢«è¯´ æ²¡å¿ƒæ²¡è‚º å¾ˆå¤šäº‹æƒ…ä¸å®¹æ˜“å½“å›äº‹ä½†çœŸçš„è¿™ä¸ªäº”ä¸ªä¸€ é™èˆª** æƒ³å¿… æˆ‘èƒ½è®°å¾ˆä¹… ç”šè‡³ä¸€è¾ˆå­å§ è‹±å›½Â·æ ¼æ‹‰æ–¯å“¥ æ˜¾ç¤ºåœ°å›¾'

çœ‹å¾—å‡ºè¿™ä¸ª åšä¸»çš„æ„¤æ‡‘çš„å¿ƒæƒ…ï¼Œæ‹¿å‡ºå°æœ¬æœ¬ï¼Œå¼€å§‹è®°ä»‡ã€‚ã€‚ã€‚
## 2.2 è‡ªç„¶è¯­è¨€å¤„ç†
Xå¸ˆå‚…å¹³æ—¶åŸºæœ¬æ²¡æ€ä¹ˆæ¥è§¦è¿‡ä¸­æ–‡NLPï¼Œè¿™æ¬¡è¦å¯¹å¾®åšå†…å®¹è¿›è¡Œæƒ…æ„Ÿåˆ†æï¼Œæœ¬æ¥æ‰“ç®—ç”¨ç™¾åº¦åŸºäºpaddlepaddleçš„ä¸­æ–‡NLPæ¨¡å‹(Senta)[https://github.com/baidu/Senta]ï¼Œè¿™äº›ä¸ªå¼€æºå¹³å°å®åœ¨æ˜¯å¯¹ Windows å¹³å°ä¸å‹å¥½ã€‚æäº†ä¸€æ•´å¤©ï¼Œé¢„è®­ç»ƒæ¨¡å‹ä¹ŸåŠ è½½ä¸å‡ºæ¥ã€‚ã€‚ã€‚äºæ˜¯å°±å»ç™¾åº¦AI ç”³è¯·äº†ä¸ªè´¦å·ï¼Œç”¨ä¸€ç”¨äººå®¶çš„(æ–‡å­—æƒ…æ„Ÿåˆ†æAPI)[https://ai.baidu.com/tech/nlp/sentiment_classify]ã€‚ é€ å¥½çš„è½®å­ç”¨èµ·æ¥ä¹Ÿæ˜¯çœŸçš„æ–¹ä¾¿ï¼ˆå°±æ˜¯å‡†ç¡®åº¦ä»æœ‰å¾…å•†æ¦·ï¼‰

#### 2.2.1 æ–‡å­—æƒ…æ„Ÿåˆ†æï¼š ç™¾åº¦ai  API

```python
# encoding:utf-8
import pandas as pd
import numpy as np
import tqdm 
tqdm.tqdm_notebook().pandas()

import os
import urllib 
import json
import requests 
import time

def get_AT(AK,SK):
    # client_id ä¸ºå®˜ç½‘è·å–çš„AKï¼Œ client_secret ä¸ºå®˜ç½‘è·å–çš„SK
    host = "https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id={}&client_secret={}".format(AK,SK)

    response = requests.get(host)
    if response:
        print('Successfully get access_token')
        return response.json()['access_token']
    else:
        print('Unable get access_token, retry in 3s...')
        time.sleep(3)
        return get_AT(AK,SK)

def request_api(text, url):
    """
    UTF-8 encode, use given url
    """
    # send request
    data = json.dumps({'text':text}).encode('utf-8')
    request = urllib.request.Request(url=url,data=data)
    request.add_header('Content-Type', 'application/json')
    
    # get answer
    response = urllib.request.urlopen(request)
    if response:
        content = response.read().decode('utf-8')

        rdata = json.loads(content)
        return rdata
    else:
        print('Error, retry in 3s...')
        time.sleep(3)
        return request_api(text, api, AT)

# Config  
AK = " your acces key å»ç™¾åº¦AI ç”³è¯·"
SK = "your security key åŒä¸Š"

AT = get_AT(AK,SK) # Access Token ä¸€èˆ¬æ¥è¯´ ç”³è¯·ä¸€æ¬¡å°±å¥½ï¼Œæœ‰æ•ˆæœŸå¯ä»¥æŒç»­ä¸€ä¸ªæœˆ
sentiment_classify_api = "https://aip.baidubce.com/rpc/2.0/nlp/v1/sentiment_classify"

# prepare data and url
url = sentiment_classify_api+"?charset=UTF-8&access_token="+AT

res_list = []
items_dic = {
    'positive_prob':[],
    'negative_prob':[],
    'confidence':[],
    'sentiment':[]
    }

# POST baidu API
for s in tqdm.notebook.tqdm(texts):
    res_list.append(request_api(s, url))

# flatten results
for res in res_list:
    try:
        res_items = res['items'][0]
    except:
        res_items = {'positive_prob': 0, 'confidence': 0, 'negative_prob': 0, 'sentiment': 1}
    
    for key in res_items.keys():
        items_dic[key].append(res_items[key])   

# update result to df
for key in items_dic.keys():
    df[key] = items_dic[key]

df['error_sentiment'] = 0
df[df['confidence'] == 0]['error_sentiment'] = 1

df['sentiment'].value_counts()
```

è°ƒç”¨å®ŒAPIï¼Œ
æ€»ä½“æ¥çœ‹ï¼Œè¿™äº›å¾®åšå¯¹ äº”ä¸ªä¸€ æ€åº¦è¿˜æ˜¯æ¶ˆæåå¤šä¸€äº›
| ç§¯æ | æ¶ˆæ| ä¸­æ€§ |
|--|--|--|
| 1297 | 2191 | 142 |

å†çœ‹çœ‹APIç»™çš„æƒ…æ„Ÿåˆ†æç½®ä¿¡åº¦ï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://user-gold-cdn.xitu.io/2020/6/2/17273f6e4b215202?w=1338&h=743&f=png&s=56913)
æ™®éæ¥è¯´ï¼Œç½®ä¿¡åº¦è¿˜æ˜¯æŒºé«˜çš„ï¼Œçœ‹ä¼¼æƒ…æ„Ÿåˆ†æå®Œç¾æ— ç¼ºã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯äº²çœ¼ç§ç§æ•°æ®æ¯”è¾ƒå¥½ã€‚

ç§¯æ ï¼š  
- 'äºŒåº¦ç¥è¯:äº”ä¸ªä¸€**çœŸçš„ç»äº†ã€‚åˆ«è¯´ç•™å­¦ç”Ÿäº†ï¼Œé‚£äº›åªæ˜¯æ¥çŸ­æš‚çœ‹æœ›ç•™å­¦ç”Ÿçš„çˆ¶æ¯ä¹Ÿå›ä¸å»â€¦ä¸ªä¸­æ»‹å‘³ï¼Œåªæœ‰æ»ç•™åœ¨æµ·å¤–çš„äººæ‰èƒ½ä½“ä¼šäº†ã€‚ \xa0'
-  'ç»˜å­Nance:6æœˆå‡ºå‘ å•†åŠ¡èˆ± èŠåŠ å“¥/æ´›æ‰çŸ¶ è½¬æœºä¸¤æ¬¡é£å¦é—¨è¡Œæç›´æŒ‚æ— éœ€ç­¾è¯ 5.3w #å›å›½æœºç¥¨##ç¾å›½æœºç¥¨# #ç•™å­¦ç”Ÿå›å›½##å›½é™…å®¢è¿èˆªç­äº”ä¸ªä¸€**#
-  'å®¿è¿ä¹‹å£°:ã€å¤–äº¤éƒ¨ï¼š#ç›®å‰142ä¸‡ç•™å­¦ç”Ÿå°šåœ¨å›½å¤–##ç›®å‰å·²æœ‰36åä¸­å›½ç•™å­¦ç”Ÿç¡®è¯Š#ã€‘4æœˆ2æ—¥ï¼Œå›½æ–°åŠå°±ç–«æƒ…æœŸé—´ä¸­å›½æµ·å¤–ç•™å­¦äººå‘˜å®‰å…¨é—®é¢˜ä¸¾è¡Œå‘å¸ƒä¼šã€‚å¤–äº¤éƒ¨å‰¯éƒ¨é•¿é©¬æœæ—­é€éœ²ï¼Œæˆ‘å›½æµ·å¤–ç•™å­¦ç”Ÿæ€»æ•°160ä¸‡ï¼Œç›®å‰142ä¸‡äººå°šåœ¨å›½å¤–ï¼Œåˆ†å¸ƒåœ¨ä¸åŒå›½å®¶å’Œåœ°åŒºã€‚å¤§å¤šæ•°ç•™å­¦äººå‘˜æŒ‰ç…§æƒå¨å»ºè®®ï¼Œä»ç„¶é€‰æ‹©ç•™åœ¨å½“åœ°ï¼Œå¯ä»¥é¿å…æ—…è¡Œäº¤å‰æ„ŸæŸ“å’Œä¸­è½¬å›½å®¶ç®¡æ§æªæ–½ä¸­é€”å—é˜»â€¦â€¦

ä¸­æ€§ï¼š
- 'æœå˜å‘å‘å‘:#å›½é™…å®¢è¿èˆªç­äº”ä¸ªä¸€**#æ„šè ¢ï¼Œä½†æ˜¯å¿ å¿ƒçˆ±å›½å•Š
- 'Venenoå°å˜‰:ä¸€ä¸ªä¸­å›½äººä¸€æ—¦å‡ºäº†å›½å½“äº†ä¸€ä¸ªç•™å­¦ç”Ÿå°±ä¼šä¸€ç›´ä¹°ä¸åˆ°ä¸€å¼ å›å›½çš„æœºç¥¨ï¼Œç®€ç§°äº”ä¸ªä¸€**@ä¸­å›½æ°‘èˆªç½‘

çœ‹äº†ä¸€å¤§åœˆï¼Œæˆ‘æŒ‘äº†å‡ ä¸ª æœ‰ä»£è¡¨æ€§çš„é”™è¯¯åˆ†æã€‚
- æœ‰ä¸€äº›ä¹°æœºç¥¨çš„é»„ç‰›å…šå‘å¸ƒçš„ä¹°ç¥¨ä¿¡æ¯ï¼Œå› ä¸ºå…¨æ–‡éƒ½åœ¨é™ˆè¿°å–ç¥¨ï¼ŒåŸºæœ¬éƒ½è¢«åˆ’åˆ†åˆ°ç§¯ææƒ…æ„Ÿé‡Œäº†ã€‚
- è¿˜æœ‰ä¸€äº›å¾®åšæƒ…æ€ç‰¹å¾ä¸æ˜æ˜¾ï¼Œä¾‹å¦‚ä½¿ç”¨ â€˜xxçœŸæ˜¯ç»äº†â€™ è¿™ä¸€ç±»å…³é”®è¯ï¼Œä¸åŒçš„è§£è¯»ä¼šå¯¼è‡´æƒ…æ„Ÿåˆ’åˆ†å¤±è´¥ã€‚
- è¿˜æœ‰ä¸€äº›å¾®åšä½¿ç”¨éå¸¸è°ƒä¾ƒçš„è¯­æ°”ï¼Œäº†è§£å‰å› åæœçš„äººå¯ä»¥æ ¹æ®å½“å‰è®¨è®ºä¸»é¢˜ï¼Œè‡ªåŠ¨æ„å»ºâ€˜æ–°è§£è¯»çš„äº”ä¸ªä¸€â€™ä¸â€˜äº”ä¸ªä¸€**â€™çš„è”ç³»ã€‚ä»è€Œè¯»å‡º å˜²è®½ï¼Œä¸æ»¡ç­‰è¯­æ°”ã€‚ä½†APIæä¾›çš„æ¨¡å‹æ— æ³•è‡ªåŠ¨è”ç³»ä¸Šä¸‹æ–‡è¿›è¡Œè§£è¯»ã€‚


æ‰€ä»¥ä¸ºäº†ç¡®ä¿æƒ…æ„Ÿåˆ†æçš„è´¨é‡ï¼Œæˆ‘ä»¬åªé€‰æ‹© ç½®ä¿¡åº¦>0.8 çš„å¾®åšã€‚

```python
import plotly.figure_factory as ff

df_temp = df[df['confidence'] > 0.8]
# ä¸åŒæƒ…æ„Ÿçš„å¾®åšæ¯æ—¥æ•°é‡
data = df_temp.groupby('date').agg({
    'positive':'sum',
    'negative':'sum',
    'neutre':'sum',
    })

# data = pd.DataFrame(data.values / data.sum(axis=1).values.reshape(-1,1), index=data.index, columns=data.columns)

data = pd.melt(data.reset_index(), id_vars='date', value_vars=['positive','negative','neutre'])

fig = px.bar(data_frame=data, x='date',y='value',color='variable', )
fig.update_layout(
    height=300,
    width=800,
    title='æƒ…æ„Ÿåˆ†æå˜åŒ– æ•°å€¼')
fig.show()

# ä¸åŒæƒ…æ„Ÿçš„å¾®åšæ¯æ—¥æ¯”ä¾‹
data = df_temp.groupby('date').agg({
    'positive':'sum',
    'negative':'sum',
    'neutre':'sum',
    })

data = pd.DataFrame(data.values / data.sum(axis=1).values.reshape(-1,1), index=data.index, columns=data.columns)

data = pd.melt(data.reset_index(), id_vars='date', value_vars=['positive','negative','neutre'])

fig = px.bar(data_frame=data, x='date',y='value',color='variable', )
fig.update_layout(
    height=300,
    width=800,
    title='æƒ…æ„Ÿåˆ†æå˜åŒ– ç›¸å¯¹æ¯”ä¾‹')
fig.show()

# ç½®ä¿¡åº¦

fig = ff.create_distplot([df_temp.loc[df_temp['sentiment'] == 2, 'confidence'].values,
                          df_temp.loc[df_temp['sentiment'] == 0, 'confidence'].values], ['Positive', 'Negative'], bin_size=[0.05, .025])
fig.update_layout(width=800, height=500, title='Confidence Distribution')
fig.show()
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://user-gold-cdn.xitu.io/2020/6/2/17273f6e70fcc747?w=1367&h=1024&f=png&s=96020)
è¿™æ®µæ—¶é—´ä»¥æ¥ï¼Œåˆšå‡ºæ¥çš„æ—¶å€™ï¼Œå¾®åšä¸Šçš„å£°éŸ³è¿˜æ˜¯ç›¸å¯¹ç§¯æçš„ã€‚ç»§ç»­æ‰§è¡Œï¼Œæ¶ˆæçš„å£°éŸ³è¶Šæ¥è¶Šé«˜ï¼ˆä¸­æ€§çš„åŸºæœ¬éƒ½æ˜¯é»„ç‰›ã€‚ã€‚ã€‚ï¼‰
äº‹å®åˆä¸€æ¬¡è¯æ˜ï¼Œæ²¡æœ‰å¯¹æ¯”å°±æ²¡æœ‰ä¼¤å®³ï¼Œä»æ—¶é—´çº¿ä¸Šæ¥çœ‹ï¼Œåˆšæ‰§è¡Œçš„æ—¶å€™ï¼Œæ¬§æ´²ç¾å›½çš„ç–«æƒ…è¿˜æ²¡æœ‰åˆ°æœ€é«˜ç‚¹ï¼Œéšç€å¤–å›½çš„ç–«æƒ…è¶Šæ¥è¶Šä¸¥é‡ï¼ˆ4æœˆ20æ—¥å·¦å³ï¼‰ï¼Œå›½å†…å›½å¤–ä¸€å¯¹æ¯”ï¼Œè¯¶å‘¦ï¼Œè¿˜æ˜¯æœ‰**æ§åˆ¶å¾—å¥½ï¼Œä¸æ˜çœŸç›¸çš„ç¾¤ä¼—ï¼Œçº·çº·é¼“èµ·äº†æŒã€‚ã€‚ã€‚ã€‚ä½†æ˜¯ï¼Œ5æœˆ19å·ï¼Œå› ä¸ºæ°‘èˆªå±€å®£å¸ƒæŒç»­åˆ°10æœˆåº•ï¼Œæ›¾ç»åœ¨å›½å¤–èˆªå¸é¢„è´­çš„7 8 æœˆä»½å›å›½æœºç¥¨å…¨éƒ¨è¢«å–æ¶ˆï¼Œè¯é¢˜å…³æ³¨åº¦ä¸€ä¸‹é£™å‡ã€‚ã€‚ã€‚æ¯•ç«Ÿäº‹ä¸å…³å·±ï¼Œé«˜é«˜æŒ‚èµ·ã€‚ã€‚ã€‚Xå¸ˆå‚…åœ¨æœºç¥¨è¢«å–æ¶ˆä¹‹å‰ï¼Œä¹Ÿè§‰å¾—5ä¸ª1å¦™çš„å‰å®³ã€‚ã€‚ã€‚



é‚£å›½å†…å›½å¤–çš„äººéƒ½æ€ä¹ˆçœ‹å‘¢ï¼Ÿ 
ç”¨ç”œç”œåœˆå›¾ çœ‹æ•°æ®

```python
fig = make_subplots(rows=1, cols=2, specs=[[{'type':'domain'}, {'type':'domain'}]])

fig.add_trace(go.Pie(labels=['è´Ÿé¢', 'ä¸­æ€§','æ­£é¢'], 
                     values=df[df['å‘å¸ƒè€…åœ°åŒº']=='æµ·å¤–']['sentiment'].value_counts().sort_index(), 
                     hole=.6,
                     name = 'æµ·å¤–å¾®åšæƒ…ç»ª'), 1,1)
fig.add_trace(go.Pie(labels=['è´Ÿé¢', 'ä¸­æ€§','æ­£é¢'], 
                     values=df[df['å‘å¸ƒè€…åœ°åŒº'] !='æµ·å¤–']['sentiment'].value_counts().sort_index(), 
                     hole=.6,
                     name = 'éæµ·å¤–å¾®åšæƒ…ç»ª'), 1,2)

fig.update_traces(hole=0.5, hoverinfo='label+percent+name')
fig.update_layout(
    title_text = 'æµ·å¤–/å›½å†… å¯¹å¾…äº”ä¸ªä¸€ å¾®åšæƒ…æ„Ÿåˆ†æ',
    annotations=[dict(text='æµ·å¤–', x=0.18, y=0.5, font_size=20, showarrow=False),
                 dict(text='å›½å†…', x=0.82, y=0.5, font_size=20, showarrow=False)]
)

fig.show()
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://user-gold-cdn.xitu.io/2020/6/2/17273f6e89ed000b?w=676&h=366&f=png&s=32717)


```python
fig = make_subplots(rows=1, cols=3, specs=[[{'type':'domain'}, {'type':'domain'},{'type':'domain'}]])

fig.add_trace(go.Pie(labels=['è´Ÿé¢', 'ä¸­æ€§','æ­£é¢'], 
                     values=df[df['if_å®˜åª’']==1]['sentiment'].value_counts().sort_index(), 
                     hole=.6,
                     name = 'å®˜åª’å¾®åšæƒ…ç»ª'), 1,1)
fig.add_trace(go.Pie(labels=['è´Ÿé¢', 'ä¸­æ€§','æ­£é¢'], 
                     values=df[df['if_è‡ªåª’'] == 1]['sentiment'].value_counts().sort_index(), 
                     hole=.6,
                     name = 'è‡ªåª’å¾®åšæƒ…ç»ª'), 1,2)
fig.add_trace(go.Pie(labels=['è´Ÿé¢', 'ä¸­æ€§','æ­£é¢'], 
                     values=df[df['if_ä¸ªäººç”¨æˆ·'] == 1]['sentiment'].value_counts().sort_index(), 
                     hole=.6,
                     name = 'ä¸ªäººç”¨æˆ·å¾®åšæƒ…ç»ª'), 1,3)

fig.update_traces(hole=0.5, hoverinfo='label+percent+name')
fig.update_layout(
    title_text = 'å„ç§ç±»å‹åª’ä½“ å¯¹å¾…äº”ä¸ªä¸€ å¾®åšæƒ…æ„Ÿåˆ†æ',
    annotations=[dict(text='å®˜åª’', x=0.1, y=0.5, font_size=20, showarrow=False),
                 dict(text='è‡ªåª’', x=0.5, y=0.5, font_size=20, showarrow=False),
                 dict(text='ä¸ªäºº', x=0.9, y=0.5, font_size=20, showarrow=False)]
)

fig.show()
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://user-gold-cdn.xitu.io/2020/6/2/17273f6e96bbb0d7?w=666&h=315&f=png&s=33948)



#### 2.2.2 è¯äº‘å›¾

```python
import jieba
from wordcloud import WordCloud

def get_stopwords(path):
    with open(path, 'r', encoding="utf8") as f:
        stopwords = [line.strip() for line in f.readlines()]    
    stopwords = list(set(stopwords))
    return stopwords

def plot_wordcloud(words, stopwords, path = '../output/è¯äº‘.png'):
    wordcloud = WordCloud(stopwords=stopwords, background_color="white", max_words=1000).generate(words)
    plt.imshow(wordcloud, interpolation='bilinear')
    plt.axis("off")
    plt.savefig(path ,dpi=400)

jieba.load_userdict('../user_dict/dict.txt')

texts = df['text_preprocessed'].values.tolist()
texts_splited = []
for s in texts:
    texts_splited.append(' '.join([i for i in jieba.cut(s,use_paddle=True)]))

df['texts_splited'] = texts_splited

stopwords = get_stopwords('../user_dict/dict.txt') +\
    ['å®¢è¿','èˆªç­','å¯èƒ½','çŸ¥é“','å°±æ˜¯','å¯ä»¥','ä¸æ˜¯',
    'ä¸èƒ½','å› ä¸º','æ˜¾ç¤º','åŸå›¾','æˆ‘ä»¬','ä½ ä»¬','è‡ªå·±',
    'è¿˜æ˜¯','åœ°å›¾','çœŸçš„','æ²¡æœ‰','è¿™ä¸ª','ä»€ä¹ˆ','ä»–ä»¬',
    'ç°åœ¨','ä½†æ˜¯','å¦‚æœ']
plot_wordcloud(' '.join(texts_splited))
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://user-gold-cdn.xitu.io/2020/6/2/17273f6ebad92f46?w=347&h=179&f=png&s=85497)


å…¶å®å¼€å§‹å¬è¯´ä»€ä¹ˆ5ä¸ª1æ”¿ç­–çš„æ—¶å€™ï¼Œæˆ‘æ˜¯ä¸¾åŒæ‰‹åŒè„šèµæˆã€‚è™½ç„¶æ”¿ç­–ä¸ŠåŸºæœ¬ä¸€åˆ€åˆ‡é™¤äº†å›å›½é€”å¾„ï¼Œä½†æ˜¯ç´§æ€¥çŠ¶å†µå°±åº”è¯¥å¿«é€Ÿå¤„ç†ï¼Œèº«ä¸ºä¸­å›½äººï¼ŒXå¸ˆå‚…è¿˜æ˜¯ååˆ†ç†è§£å’±å›½å®¶çš„å›°éš¾çš„ã€‚å°¤å…¶å½“æ˜¯æµ·å¤–ç–«æƒ…æ­£å¤„äºçˆ†å‘æœŸï¼Œå›½å†…ç–«æƒ…ä¹Ÿæ‰åˆšåˆšæ§åˆ¶ä½ï¼Œç†åº”è®©å’±é‚£äº›è¾›è¾›è‹¦è‹¦æŠ—ç–«2ä¸ªæœˆçš„åŒ»æŠ¤äººå‘˜ä»¬ï¼Œç¨å¾®ä¼‘æ¯ä¸€ä¸‹äº†ã€‚é™¤äº†ä¿ç•™ä¸€éƒ¨åˆ†ç»™å¿…é¡»å›å›½çš„å°å­©å­ä»¬ï¼Œå‰©ä¸‹çš„å›½é™…èˆªç­èƒ½å‡å°‘å°±å‡å°‘ä¸€äº›å§ï¼Œå’±ä»¬è¿™ç§èº«å¼ºä½“å£®ï¼Œè‡ªç»™è‡ªè¶³çš„å¹´è½»äººä¹Ÿåº”è¯¥ç»™å¤®å¦ˆå‡ç‚¹è´Ÿæ‹…ã€‚å½“æ—¶çš„Xå¸ˆå‚…å§‹ç»ˆæŠ±ç€è¿™æ ·çš„å¿ƒæ€ã€‚ç†è§£

è¿™ä¸¤ä¸ªæœˆé‡Œï¼Œèº«è¾¹çš„æœ‹å‹é™†é™†ç»­ç»­å›å›½ï¼Œæ›¾ç»çˆ†æ»¡çš„éš”ç¦»é…’åº—ä¹Ÿéƒ½ç©ºé—²äº†ä¸‹æ¥ã€‚ç°åœ¨çš„æƒ…å†µæ˜¯å¾…æ£€æµ‹çš„äººæ•°è¿˜æ²¡æœ‰å·¥ä½œäººå‘˜å¤šï¼ˆå¬ä¸Šå‘¨å›å›½çš„æœ‹å‹è¯´ï¼Œä¸‹äº†é£æœºä¹‹åï¼Œè¢«ä¹Œæ³±æ³±çš„ä¸€ç¾¤å·¥ä½œäººåŒ…å›´èµ·æ¥ï¼Œç”¨30cmé•¿çš„é¢ç­¾æˆ³é¼»å­” lolã€‚ç—›å¿« ï¼ˆ-_-ï¼‰ï¼‰ã€‚è€Œä¸”ä¸–ç•Œå„å›½ï¼ˆå·å»ºå›½ä»–ä»¬å®¶é™¤å¤–ï¼‰çš„ç–«æƒ…ä¹Ÿéƒ½å¹³å®‰åº¦è¿‡äº†ç¬¬ä¸€æ®µçˆ†å‘æœŸã€‚ç„¶è€Œï¼Œæ°‘èˆªå±€å†æ¬¡å®£å¸ƒå»¶é•¿äº”ä¸ªä¸€åˆ°10æœˆåº•ã€‚Xå¸ˆå‚…çš„å¿ƒæ€ç¬é—´å´©äº†ã€‚ã€‚ã€‚å‰æ®µæ—¶é—´åˆšå¹äº†ä¸€æ³¢å¤§ä½¿é¦†æ´¾å‘çš„å¥åº·åŒ…ï¼Œæ€ä¹ˆä¹Ÿæƒ³ä¸åˆ°è¿™ä¸ªå¥åº·åŒ…ç«Ÿç„¶æ˜¯æœ€åçš„è¡¥ç»™ã€‚å†å»å¾®åšä¸Šä¸€çœ‹ï¼Œè€é“ä»¬çš„å˜´å¯çœŸç¢ã€‚ä»€ä¹ˆç•™å­¦ç”Ÿå›å›½å°±æ˜¯åƒé‡ŒæŠ•æ¯’ç†åº”è¢«é©±é€ï¼Œä»€ä¹ˆå½“åˆç–«æƒ…æ—¶æœŸé€‰æ‹©ç¦»å¼€æ´»è¯¥ç°åœ¨å›ä¸æ¥ã€‚é™¤äº†å¿ƒå¯’è¿˜æ˜¯å¿ƒå¯’ã€‚åªèƒ½å¥‰åŠä¸€å¥ï¼Œå˜´ä¸Šä¸ç§¯å¾·ï¼Œç”Ÿå¨ƒæ²¡PYã€‚

å›æƒ³èµ·å½“åˆå›½å†…ç–«æƒ…åˆæœŸï¼Œèº«è¾¹çš„åäººæœ‹å‹è”ç³»å•†ä¼šï¼Œæ‹‰æ‹¢æ ¡å‹ï¼Œæœ‰é’±çš„å‡ºé’±æœ‰åŠ›çš„å‡ºåŠ›ï¼Œä»æ¬§æ´²çš„å„å¤§è¯åº—è´­ç½®å£ç½©ï¼Œé˜²æŠ¤æœï¼Œç©ºè¿å›å›½ã€‚å½“åˆæé’±å‡ºåŠ›çš„ç•™å­¦ç”Ÿä»¬æ¯•ä¸šäº†ï¼Œæƒ³å›å›½ï¼Œè¿˜å¾—èŠ±æ¯”å¹³æ—¶é«˜7å€çš„ä»·æ ¼ ï¼ˆå¹³æ—¶å¾€è¿”æœºç¥¨6000å—ï¼Œå¦‚ä»Šå•ç¨‹æœºç¥¨3W+ è¿˜ä¸ä¸€å®šèƒ½ä¹°åˆ°ï¼‰ã€‚å¤±æœ›ã€‚ä¸åªæ˜¯å› ä¸ºç¥¨ä»·é«˜çš„ç¦»è°±è€Œå¤±æœ›ï¼Œæ›´æ˜¯å› ä¸ºæ°‘èˆªå±€çš„ä¸ä½œä¸ºè€Œå¤±æœ›ã€‚

å¸Œæœ›äº”ä¸ªä¸€å¯ä»¥æ—©æ—¥å˜æˆäº”ä¸ªäºŒ äº”ä¸ªä¸‰ ï¼Œç»™éœ€è¦å›å›½çš„ç•™å­¦ç”Ÿä¸€ä¸ªæœºä¼šå§
